# Polyloft Language Registration with GitHub Linguist

This guide explains how to register the Polyloft programming language (`.pf` extension) with GitHub Linguist, so that GitHub can properly detect, syntax highlight, and display statistics for Polyloft code.

## Table of Contents

1. [Overview](#overview)
2. [Prerequisites](#prerequisites)
3. [Files in this Directory](#files-in-this-directory)
4. [Implementation Steps](#implementation-steps)
5. [Testing Locally](#testing-locally)
6. [Submitting to GitHub Linguist](#submitting-to-github-linguist)
7. [After Merge](#after-merge)

## Overview

GitHub uses [Linguist](https://github.com/github/linguist) to detect and highlight code in repositories. To add support for Polyloft:

1. Add a language definition to `languages.yml`
2. Provide a TextMate grammar for syntax highlighting
3. Include sample files demonstrating the language
4. Submit a pull request to the linguist repository

## Prerequisites

Before submitting to Linguist, ensure:

- **Usage on GitHub**: The `.pf` extension should be in use in at least 200 unique `:user/:repo` repositories (see [#5756](https://github.com/github/linguist/issues/5756) for temporary criteria changes)
- **Sample Code**: At least 2-3 representative sample files showing real-world usage (not "Hello World")
- **Grammar License**: The TextMate grammar must have an [acceptable license](https://github.com/github/linguist/blob/master/vendor/licenses/config.yml)

## Files in this Directory

```
/linguist/
├── IMPLEMENTATION_GUIDE.md          # This file
├── languages.yml                    # Language definition for Linguist
├── grammars/
│   └── polyloft.tmLanguage.json    # TextMate grammar for syntax highlighting
└── samples/
    ├── fibonacci.pf                 # Sample: Fibonacci implementation
    ├── quicksort.pf                 # Sample: QuickSort algorithm
    └── class_example.pf             # Sample: Object-oriented programming
```

### 1. `languages.yml`

This file defines the Polyloft language for Linguist. Key fields:

- **type**: `programming` (vs. markup, data, prose)
- **color**: `#E53935` (Polyloft's brand color - Red Loft)
- **extensions**: `[".pf"]` (file extension)
- **tm_scope**: `source.polyloft` (matches the grammar scope)
- **language_id**: Will be auto-generated by Linguist's `script/update-ids`
- **aliases**: Alternative names for the language

### 2. `grammars/polyloft.tmLanguage.json`

A TextMate-compatible grammar defining syntax highlighting rules:

- **Comments**: `//` line comments and `/* */` block comments
- **Keywords**: `let`, `def`, `if`, `elif`, `for`, `loop`, `return`, `class`, `end`, etc.
- **Modifiers**: `public`, `private`, `protected`, `static`, `abstract`, `sealed`
- **Strings**: Double quotes with `#{}` interpolation support
- **Numbers**: Integers and floats
- **Built-in functions**: `println`, `print`, `len`, `range`, `int`, `float`, `str`, `bool`
- **Built-in classes**: `Sys`, `Array`, `String`, `Map`, etc.
- **Classes**: `class ClassName:` syntax
- **Operators**: Arithmetic (`+`, `-`, `*`, `/`), comparison (`==`, `!=`, `<`, `>`), logical (`&&`, `||`, `!`), range (`...`)


### 3. `samples/`

Representative code samples demonstrating Polyloft's features:

- **fibonacci.pf**: Iterative and memoization approaches
- **quicksort.pf**: Divide-and-conquer sorting algorithm
- **class_example.pf**: Object-oriented programming with classes

These samples are from the `algorithm_samples/` and `stress_tests/` directories and show real-world code, not trivial examples.

## Implementation Steps

### Step 1: Fork and Clone GitHub Linguist

```bash
# Fork the repository on GitHub
# Then clone your fork
git clone https://github.com/YOUR_USERNAME/linguist.git
cd linguist

# Set up the development environment
script/bootstrap
```

### Step 2: Add Language Definition

Add the Polyloft entry to `lib/linguist/languages.yml` in the Linguist repository:

```yaml
Polyloft:
  type: programming
  color: "#E53935"
  extensions:
  - ".pf"
  tm_scope: source.polyloft
  ace_mode: text
  language_id: 0  # Omit initially, will be generated
  aliases:
  - pf
  - polyloft-lang
```

**Important**: Keep extensions in alphabetical order (case-sensitive). The primary extension should be first.

### Step 3: Add TextMate Grammar

Add the grammar to Linguist using the automated script:

```bash
# If you have a GitHub repository with the grammar
script/add-grammar https://github.com/ArubikU/polyloft-grammar

# OR manually add it to vendor/grammars/
mkdir -p vendor/grammars/polyloft
cp /path/to/polyloft.tmLanguage.json vendor/grammars/polyloft/
```

The grammar repository should:
- Have an [acceptable license](https://github.com/github/linguist/blob/master/vendor/licenses/config.yml) (MIT, Apache-2.0, BSD, etc.)
- Contain a valid TextMate grammar file
- Be publicly accessible

**Alternative**: You can also submit the grammar inline in your PR if it's small enough.

### Step 4: Add Sample Files

Copy sample files to the Linguist samples directory:

```bash
# Create samples directory for Polyloft
mkdir -p samples/Polyloft

# Copy samples (at least 2-3 files)
cp linguist/samples/fibonacci.pf samples/Polyloft/
cp linguist/samples/quicksort.pf samples/Polyloft/
cp linguist/samples/class_example.pf samples/Polyloft/
```

**Requirements**:
- Use real-world code showing common patterns
- Avoid "Hello World" examples
- Include license information in comments or PR description
- Demonstrate various language features

### Step 5: Generate Language ID

Run the Linguist script to generate a unique language ID:

```bash
script/update-ids
```

This will update the `language_id` field in `languages.yml`.

### Step 6: Test Locally

Test that Linguist correctly detects and highlights Polyloft files:

```bash
# Run tests
bundle exec rake test

# Test the classifier
bundle exec script/cross-validation --test

# Test on a specific file
bundle exec bin/github-linguist /path/to/file.pf --breakdown
```

## Testing Locally

Before submitting, verify everything works:

### 1. Test Language Detection

```bash
cd linguist
bundle exec bin/github-linguist /path/to/polyloft/repo --breakdown
```

Expected output should show `.pf` files detected as "Polyloft".

### 2. Test Syntax Highlighting

Use a TextMate-compatible editor (Sublime Text, Atom, VS Code) to verify:
- Keywords are highlighted
- Strings and interpolation work
- Comments are styled correctly
- Classes and functions are recognized

### 3. Validate Grammar

Check for grammar issues:

```bash
bundle exec rake grammar:check
```

## Submitting to GitHub Linguist

### Prepare Your Pull Request

1. **Search GitHub**: Provide a link to a [GitHub code search](https://github.com/search?type=code) showing `.pf` files in use:
   ```
   https://github.com/search?type=code&q=NOT+is%3Afork+path%3A*.pf
   ```

2. **License Information**: State the license for:
   - Sample code files
   - TextMate grammar
   
   Example:
   > "All sample files are from the Polyloft repository and are licensed under the MIT license.
   > The TextMate grammar is also MIT licensed and available at https://github.com/ArubikU/polyloft"

3. **Usage Statistics**: If possible, show:
   - Number of repositories using `.pf`
   - Example projects
   - Community size

### Open the Pull Request

```bash
# In your linguist fork
git checkout -b add-polyloft-language
git add lib/linguist/languages.yml
git add vendor/grammars/polyloft/
git add samples/Polyloft/
git commit -m "Add support for Polyloft programming language"
git push origin add-polyloft-language
```

Then open a PR at https://github.com/github/linguist/pulls

### PR Description Template

```markdown
## Add support for Polyloft programming language

This PR adds support for the Polyloft programming language (`.pf` extension).

### Language Overview
Polyloft is a hybrid programming language combining object-oriented structure 
with scripting flexibility. It's designed for teaching, experimentation, and 
creating powerful scripts without sacrificing clarity.

- **Website**: https://github.com/ArubikU/polyloft
- **Extension**: `.pf`
- **Type**: Programming language

### Usage on GitHub
GitHub search showing `.pf` files in use: 
https://github.com/search?type=code&q=NOT+is%3Afork+path%3A*.pf

### Samples
All sample files are taken from the Polyloft repository and are licensed 
under the MIT license. They demonstrate:
- Fibonacci sequence implementation
- QuickSort algorithm
- Object-oriented programming with classes

### Grammar
The TextMate grammar is MIT licensed and supports:
- Keywords: `let`, `def`, `class`, `if`, `elif`, `for`, `while`, `loop`, `return`, `break`, `continue`, etc.
- Modifiers: `public`, `private`, `protected`, `static`, `abstract`, `sealed`
- String interpolation with `#{}`
- Comments: `//` (line) and `/* */` (block)
- Classes and functions
- Built-in functions: `println`, `print`, `len`, `range`, `int`, `float`, `str`, `bool`
- Built-in classes: `Sys`, `Array`, `String`, `Map`, etc.
- Logical operators: `&&`, `||`, `!`
- Range operator: `...`

### Checklist
- [x] Added entry to `languages.yml`
- [x] Added TextMate grammar
- [x] Added sample files (2-3 representative examples)
- [x] Generated unique `language_id`
- [x] All samples are real-world code, not "Hello World"
- [x] Stated license for samples and grammar
- [x] Linked to GitHub search showing usage
```

## After Merge

### Timeline

After your PR is merged:
1. **Linguist Release**: Next Linguist release (typically monthly)
2. **GitHub.com Deployment**: 1-2 weeks after Linguist release
3. **Full Rollout**: May take a few more weeks for caching to clear

### What Changes on GitHub

Once deployed:
- `.pf` files will show syntax highlighting
- Repository language statistics will include Polyloft
- `.pf` will be searchable as a language filter
- GitHub will use the color `#E53935` for Polyloft in graphs

### Repository Configuration

While waiting for deployment, you can configure `.gitattributes`:

```bash
# In your Polyloft repository
echo "*.pf linguist-language=Polyloft" >> .gitattributes
git add .gitattributes
git commit -m "Configure linguist for .pf files"
```

This helps with:
- Language detection override
- Excluding certain files from statistics
- Vendored/generated code handling

Example `.gitattributes`:

```gitattributes
# Mark .pf files as Polyloft
*.pf linguist-language=Polyloft

# Exclude test files from language statistics
stress_tests/*.pf linguist-vendored
algorithm_samples/*.pf linguist-documentation

# Mark generated files
generated/*.pf linguist-generated
```

## Additional Resources

- [Linguist Contributing Guide](https://github.com/github/linguist/blob/master/CONTRIBUTING.md)
- [Linguist Languages Documentation](https://github.com/github/linguist/blob/master/lib/linguist/languages.yml)
- [TextMate Grammar Documentation](https://manual.macromates.com/en/language_grammars)
- [GitHub Linguist Troubleshooting](https://github.com/github/linguist/blob/master/docs/troubleshooting.md)

## Support

For issues or questions:
- **Polyloft**: https://github.com/ArubikU/polyloft/issues
- **Linguist**: https://github.com/github/linguist/issues

## License

This implementation guide and associated files are part of the Polyloft project and are licensed under the MIT License.
